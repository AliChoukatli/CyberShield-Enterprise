# 07 - Windows Autopilot - AzureAD Join

## ðŸŽ¯ Objective

Simulate a modern Windows 11 deployment using **Windows Autopilot** and **Microsoft Intune**, without relying on on-premises infrastructure. This lab demonstrates how to register a device for Autopilot, create and assign deployment profiles, and trigger an automatic enrollment during the deviceâ€™s Out-of-Box Experience (OOBE).
> Instead of using the Instant Sandbox provided by the Microsoft 365 Developer Program, this lab uses a Microsoft 365 E3 Trial tenant, where Intune was available by default. This setup allows full access to Endpoint Manager and Autopilot features.
---

## ðŸ§° Prerequisites

| Component                            | Details                                                                                                 |
|--------------------------------------|---------------------------------------------------------------------------------------------------------|
| âœ… Microsoft 365 E3 tenant           | Created from [Microsoft 365 E3 ](https://www.microsoft.com/en-ca/microsoft-365/enterprise/e3?activetab=pivot:overviewtab) |
| âœ… Intune enabled                    | Check access via [https://endpoint.microsoft.com](https://endpoint.microsoft.com)                       |
| âœ… Windows 11 VM (Pro or Enterprise) | Installed using official evaluation ISO                                                                 |
| âœ… PowerShell Admin on the VM | Required to extract the Hardware Hash (HWID)                                                                   |

---

## ðŸ§± Folder Structure

```bash
07_Autopilot/
â”œ
```
---

## âœ… Step-by-step Instructions


### ðŸ§© Step 1 â€“ Create your Microsoft 365 Dev tenant

### âœ… Instructions:

1. Go to [Microsoft website to buy the licence](https://www.microsoft.com/en-ca/microsoft-365/enterprise/e3?activetab=pivot:overviewtab) > Try for free
2. Fill out the registration form with your details.  
3. Provide your credit card information for verification purposes.  
4. After the verification process completes, you will be redirected to your Microsoft 365 dashboard.  

![Dashboard_E3](https://github.com/AliChoukatli/CyberShield-Enterprise/blob/main/07_Autopilot/Screenshots/Licence_E3.png)

---

## ðŸ§© Step 2 â€“ Creating Dynamic Group for Windows 10/11 Devices 
> it's recommended to create a **dynamic Azure AD device group** that automatically includes all Windows 10 and Windows 11 devices.
> This group can then be assigned an Autopilot deployment profile, so all devices in the group receive the correct configuration automatically.

1. Go to the [Entra ID Portal](entra.microsoft.com) and navigate to  **Groups > New Group**.  
2. Set the following parameters:
   - **Group type:** `Security`
   - **Group name:** `Windows 10/11 Devices`  
   - **Membership type:** `Dynamic Device`
3. Click **Add dynamic query** and in the **Rule syntax** box, enter the following rule:

```plaintext
(device.deviceOSType -eq "Windows") and ((device.deviceOSVersion -startsWith "10") or (device.deviceOSVersion -startsWith "11"))
```
![Win10/11 Devices](https://github.com/AliChoukatli/CyberShield-Enterprise/blob/main/07_Autopilot/Screenshots/win10-11_devices_group.png)

4. Click **Create**
## ðŸ§© Step 3 â€“ Create an Autopilot Deployment Profile

1. Go to [https://endpoint.microsoft.com](https://endpoint.microsoft.com).  
2. Navigate to:  
   `Devices > Windows > Windows enrollment > Deployment Profiles`  
3. Click **+ Create profile**.  
4. Select **Windows PC**.  
5. Enter a **Name** for the profile (e.g., `Autopilot_AzureAD_UserDriven`).
6. Set Convert all targeted devices to Autopilot to `No`.
7. Configure the Out-of-box experience (OOBE) settings:
   - **Deployment mode** : ` User-Driven`
   - **Join to MicrosoftEntra ID as**:`Microsoft Entra Joined`
   - **Privacy settings**:`Hide` (to skip privacy prompts during setup).
   - **Hide change account options** : `Hide`.
   - **User account type**: `Standard`  
   - **Allow pre-provisioned deployment**: `NO`
   - **Language (Region)** : `Operating system default`.
   - **Automatically configure keyboard**: `Yes` (So that the keyboard is automatically configured according to the language.)
   - **Apply device name template**: `No` (Unless you want to apply an automatic naming convention to device names.)
  
8. Click on Assignments

- Choose the device groups or specific devices that should receive this Autopilot profile.

- Click Save to apply the assignment.

9. Click **Create** to finish creating the deployment profile.

**Captures to take:**  
- `2-profile-creation-1.png` (Profile creation start screen)  
- `3-profile-creation-2.png` (OOBE settings configuration screen)

---

## ðŸ§© Step 3 â€“ Generate the Hardware ID (HWID) from the VM

1. Launch your Windows 11 VM (Pro or Enterprise).  
2. Open PowerShell as Administrator.  
3. Run the following commands:

```powershell
Install-Script -Name Get-WindowsAutopilotInfo -Force
Get-WindowsAutopilotInfo -OutputFile AutoPilotHWID.csv
```

4. Transfer the generated AutoPilotHWID.csv file to your host machine.
Capture to take:
powershell-hwid.png



## ðŸ§© Step 4 â€“ Import the Device into Intune

In Endpoint Manager, navigate to:  
`Devices > Windows > Windows enrollment > Devices`

Click **Import**.

Upload the `AutoPilotHWID.csv` file.

Wait until the device appears in the list.

**Captures to take:**  
- `5-import-device.png`  
- `6-device-imported.png`

---

## ðŸ§© Step 5 â€“ Assign the Autopilot Profile to the Device

Select the imported device from the list.

Click **Assign profile**.

Choose the deployment profile you created earlier.

Confirm the assignment.

**Capture to take:**  
`7-assign-profile.png`

---

## ðŸ§© Step 6 â€“ Reset or Reinstall the VM to Trigger Autopilot

Optionally, reset or reinstall the Windows 11 VM.

On first boot, the device will contact Autopilot service and begin automatic enrollment.

Intune will apply the assigned profile and policies.

**Optional captures:**  
- `8-oobe-start.png` (OOBE start screen on VM reset)  
- `9-intune-autoconfig.png` (Intune automatic configuration screen)
